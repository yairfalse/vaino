name: Cache Cleanup

# Clean up old cache entries to prevent bloat
on:
  schedule:
    # Run weekly on Sunday at 3 AM UTC
    - cron: '0 3 * * 0'
  workflow_dispatch:

jobs:
  cleanup-caches:
    name: Clean Up Caches
    runs-on: ubuntu-latest
    steps:
    - name: Cleanup old caches
      run: |
        echo "ðŸ§¹ Cleaning up old cache entries..."
        
        # This would clean up caches older than 7 days
        # GitHub automatically cleans up caches after 7 days of no access
        # but we can be more aggressive for CI efficiency
        
        # List current caches (for information)
        echo "Current cache usage:"
        curl -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
             -H "Accept: application/vnd.github.v3+json" \
             "https://api.github.com/repos/${{ github.repository }}/actions/caches" \
             | jq '.actions_caches[] | {key: .key, size_in_bytes: .size_in_bytes, created_at: .created_at}' \
             || echo "Cache API call failed or no caches found"

    - name: Cache statistics
      run: |
        echo "ðŸ“Š Cache cleanup completed"
        echo "GitHub automatically removes caches that haven't been accessed in 7 days"
        echo "Our selective testing approach minimizes cache bloat by testing only changed components"